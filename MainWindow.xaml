<controls:MetroWindow x:Class="CSuiteViewWPF.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
    xmlns:local="clr-namespace:CSuiteViewWPF"
    xmlns:models="clr-namespace:CSuiteViewWPF.Models"
        mc:Ignorable="d"
        Title="CSuite View" 
        Height="600" 
        Width="800"
        MinWidth="400"
        MinHeight="300"
        WindowStartupLocation="CenterScreen"
        GlowBrush="{x:Null}"
        BorderThickness="0"
        BorderBrush="Transparent"
        Background="Transparent"
    ResizeMode="CanResize"
        TitleBarHeight="0"
        WindowTitleBrush="Transparent"
        NonActiveWindowTitleBrush="Transparent"
        WindowTransitionsEnabled="False"
        TitleCharacterCasing="Normal"
        TitleForeground="Transparent"
        ShowTitleBar="False">
    
    <controls:MetroWindow.Resources>
        <ObjectDataProvider x:Key="NavigationData"
                            ObjectType="{x:Type models:NavigationSampleData}"
                            MethodName="GetNodes"/>

        <DataTemplate x:Key="TreeListRowTemplate">
            <Grid Margin="0,2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="{Binding Name}" Foreground="#2C5AA0"/>
                <TextBlock Grid.Column="1"
                           Text="{Binding Type}"
                           Foreground="#2C5AA0"/>
                <TextBlock Grid.Column="2"
                           Margin="12,0,0,0"
                           Text="{Binding Children.Count}"
                           Foreground="#2C5AA0"/>
            </Grid>
        </DataTemplate>

        <Style x:Key="TreeListItemStyle" TargetType="TreeViewItem">
            <Setter Property="HeaderTemplate" Value="{StaticResource TreeListRowTemplate}"/>
            <Setter Property="ItemsSource" Value="{Binding Children}"/>
            <Setter Property="Foreground" Value="#2C5AA0"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="Padding" Value="2"/>
        </Style>

        <Style x:Key="FileListItemStyle" TargetType="ListBoxItem">
            <Setter Property="Background" Value="#8BB9F5"/>
            <Setter Property="Foreground" Value="#2C5AA0"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="Margin" Value="0,2,0,2"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border x:Name="ItemBorder"
                                Background="{TemplateBinding Background}"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center"
                                              HorizontalAlignment="Left"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="ItemBorder" Property="Background" Value="#A7C9FF"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="ItemBorder" Property="Background" Value="#FFD700"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <DataTemplate x:Key="ListLeafTemplate">
            <TextBlock Text="{Binding Name}" Foreground="#2C5AA0" Margin="4,1,0,1"/>
        </DataTemplate>

        <DataTemplate x:Key="ListChildTemplate">
            <StackPanel>
                <TextBlock Text="{Binding Name}" FontWeight="SemiBold" Foreground="#2C5AA0" Margin="0,2,0,2"/>
                <ItemsControl ItemsSource="{Binding Children}"
                              ItemTemplate="{StaticResource ListLeafTemplate}"
                              Margin="12,2,0,6"/>
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="ListGroupTemplate">
            <Expander Header="{Binding Name}" IsExpanded="False" Margin="0,4,0,4">
                <ItemsControl ItemsSource="{Binding Children}"
                              ItemTemplate="{StaticResource ListChildTemplate}"
                              Margin="12,4,0,4"/>
            </Expander>
        </DataTemplate>

        <HierarchicalDataTemplate x:Key="NavigationTreeTemplate" ItemsSource="{Binding Children}">
            <TextBlock Foreground="#2C5AA0">
                <Run Text="{Binding Name}"/>
                <Run Text="  "/>
                <Run Text="{Binding Type}" FontStyle="Italic" Foreground="#CC2C5AA0"/>
            </TextBlock>
        </HierarchicalDataTemplate>

        <Style x:Key="FlatTreeViewStyle" TargetType="TreeView">
            <Setter Property="Background" Value="#8BB9F5"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="2"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TreeView">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Padding="{TemplateBinding Padding}">
                            <ScrollViewer Focusable="False"
                                          HorizontalScrollBarVisibility="Disabled"
                                          VerticalScrollBarVisibility="Auto">
                                <ItemsPresenter/>
                            </ScrollViewer>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="NavigationTreeViewItemStyle" TargetType="TreeViewItem">
            <Setter Property="Foreground" Value="#2C5AA0"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Margin" Value="0,0,0,0"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TreeViewItem">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>

                            <Border x:Name="HeaderBorder"
                                    Background="Transparent"
                                    CornerRadius="6"
                                    Padding="2,0,5,0">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <ToggleButton x:Name="Expander"
                                                  Grid.Column="0"
                                                  Width="14"
                                                  Height="14"
                                                  Margin="0,0,5,0"
                                                  VerticalAlignment="Center"
                                                  IsChecked="{Binding IsExpanded, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}"
                                                  ClickMode="Press"
                                                  Background="Transparent"
                                                  BorderThickness="0"
                                                  Focusable="False">
                                        <ToggleButton.Template>
                                            <ControlTemplate TargetType="ToggleButton">
                                                <Border x:Name="ToggleBox"
                                                        Width="14"
                                                        Height="14"
                                                        Background="#60A0FF"
                                                        BorderBrush="#2C5AA0"
                                                        BorderThickness="1"
                                                        CornerRadius="6"
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center">
                                                    <Grid>
                                                        <Rectangle Width="8" Height="2" Fill="#2C5AA0" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                        <Rectangle x:Name="VerticalBar" Width="2" Height="8" Fill="#2C5AA0" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Grid>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsChecked" Value="True">
                                                        <Setter TargetName="VerticalBar" Property="Visibility" Value="Collapsed"/>
                                                    </Trigger>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="ToggleBox" Property="Background" Value="#75B4FF"/>
                                                        <Setter TargetName="ToggleBox" Property="BorderBrush" Value="#23467D"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </ToggleButton.Template>
                                    </ToggleButton>

                                    <ContentPresenter Grid.Column="1"
                                                      ContentSource="Header"
                                                      RecognizesAccessKey="True"
                                                      VerticalAlignment="Center"/>
                                </Grid>
                            </Border>

                            <ItemsPresenter x:Name="ItemsHost"
                                            Grid.Row="1"
                                            Margin="16,0,0,0"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsExpanded" Value="False">
                                <Setter TargetName="ItemsHost" Property="Visibility" Value="Collapsed"/>
                            </Trigger>
                            <Trigger Property="HasItems" Value="False">
                                <Setter TargetName="Expander" Property="Visibility" Value="Hidden"/>
                            </Trigger>
                            <Trigger Property="IsMouseDirectlyOver" Value="True">
                                <Setter TargetName="HeaderBorder" Property="Background" Value="#A7C9FF"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="HeaderBorder" Property="Background" Value="#FFD700"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </controls:MetroWindow.Resources>
    
    <!-- Gold Border Layer (Outer) -->
    <Border Padding="6" Background="#FFD700">
        
        <!-- Layer 1: Dark Blue (#2C5AA0) - Creates Header and Footer -->
        <Grid Background="#2C5AA0">
            <Grid.RowDefinitions>
                <RowDefinition Height="30"/>  <!-- Header space - draggable -->
                <RowDefinition Height="*"/>    <!-- Content area -->
                <RowDefinition Height="30"/>   <!-- Footer space - draggable -->
            </Grid.RowDefinitions>
            
            <!-- Layer 1 Header - Draggable with Close Button -->
            <Border Grid.Row="0" MouseLeftButtonDown="Header_MouseLeftButtonDown">
                <Border.Background>
                    <LinearGradientBrush StartPoint="0,1" EndPoint="0,0">
                        <GradientStop Color="#2C5AA0" Offset="0"/>
                        <GradientStop Color="#3761B3" Offset="0.5"/>
                        <GradientStop Color="#204A8E" Offset="1"/>
                    </LinearGradientBrush>
                </Border.Background>
                <!-- Close Button (Yellow Circle with X) -->
                <Button x:Name="CloseButton"
                        Width="20" Height="20"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        Margin="0,0,8,0"
                        Click="CloseButton_Click"
                        Cursor="Hand">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#FFD700"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Grid Width="20" Height="20">
                                            <!-- Yellow Circle -->
                                            <Ellipse Fill="{TemplateBinding Background}" 
                                                     Width="20" Height="20"/>
                                            <!-- X Symbol - Centered -->
                                            <Path Stretch="None"
                                                  Data="M 0,0 L 8,8 M 8,0 L 0,8" 
                                                  Stroke="#2C5AA0" 
                                                  StrokeThickness="2"
                                                  HorizontalAlignment="Center"
                                                  VerticalAlignment="Center"/>
                                        </Grid>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsPressed" Value="True">
                                                <Setter Property="Background" Value="#E6C200"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                </Button>
            </Border>
            
            <!-- Layer 1 Footer - Draggable -->
            <Border Grid.Row="2" MouseLeftButtonDown="Header_MouseLeftButtonDown">
                <Border.Background>
                    <LinearGradientBrush StartPoint="0,1" EndPoint="0,0">
                        <GradientStop Color="#2C5AA0" Offset="0"/>
                        <GradientStop Color="#3761B3" Offset="0.5"/>
                        <GradientStop Color="#204A8E" Offset="1"/>
                    </LinearGradientBrush>
                </Border.Background>
            </Border>
            
            <!-- Layer 2 Container in Grid.Row="1" with vertical padding -->
            <Border Grid.Row="1" Padding="0,0,0,0">
                <Grid>
                    <!-- Fine golden line at TOP (where Layer 1 meets Layer 2) -->
                    <Border BorderBrush="#FFD700" BorderThickness="0,1,0,0" 
                            VerticalAlignment="Top" Height="1" Panel.ZIndex="10"/>
                    
                    <!-- Fine golden line at BOTTOM (where Layer 2 meets Layer 1) -->
                    <Border BorderBrush="#FFD700" BorderThickness="0,0,0,1" 
                            VerticalAlignment="Bottom" Height="1" Panel.ZIndex="10"/>
                    
                    <!-- Layer 2: Medium Blue (#4169E1) - Also has Header and Footer -->
                    <Grid Background="#4169E1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="20"/>  <!-- Layer 2 Header space -->
                            <RowDefinition Height="*"/>    <!-- Layer 2 Content area -->
                            <RowDefinition Height="15"/>   <!-- Layer 2 Footer space -->
                        </Grid.RowDefinitions>
                        
                        <!-- Layer 3: Light Blue Background with 3-Panel Splitter -->
                        <!-- Padding on left/right to reveal Layer 2 border -->
                        <Border Grid.Row="1" Padding="8,0,8,0">
                            <Grid Background="Transparent">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" MinWidth="100"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*" MinWidth="100"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*" MinWidth="100"/>
                                </Grid.ColumnDefinitions>
                        
                                <!-- Panel 1 (Left) - Styled TreeView -->
                                <Border Grid.Column="0" Margin="0" Padding="0" CornerRadius="6" Background="#8BB9F5">

                                    <TreeView x:Name="NavigationTree"
                                              ItemsSource="{Binding Source={StaticResource NavigationData}}"
                                              ItemTemplate="{StaticResource NavigationTreeTemplate}"
                                              ItemContainerStyle="{StaticResource NavigationTreeViewItemStyle}"
                                              Style="{StaticResource FlatTreeViewStyle}"
                                              Background="Transparent"
                                              Foreground="#2C5AA0"
                                              AllowDrop="True"
                                              DragOver="NavigationTree_DragOver"
                                              Drop="NavigationTree_Drop"/>
                                </Border>
                    
                                <!-- Splitter 1 -->
                                <GridSplitter Grid.Column="1" 
                                              Width="5" 
                                              HorizontalAlignment="Center" 
                                              VerticalAlignment="Stretch"
                                              Background="#4169E1"
                                              ShowsPreview="False"/>
                    
                                <!-- Panel 2 (Middle) - File list for drag/drop -->
                                <Border Grid.Column="2" Background="#8BB9F5" Margin="0" Padding="0" CornerRadius="6">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>

                                        <Border Grid.Row="0" Background="#5B8DD6" CornerRadius="6" Padding="6" Margin="0,0,0,6">
                                            <TextBlock Text="Available Files"
                                                       FontWeight="Bold"
                                                       Foreground="White"/>
                                        </Border>

                                        <ListBox x:Name="FileList"
                                                 Grid.Row="1"
                                                 Background="Transparent"
                                                 BorderThickness="0"
                                                 Foreground="#2C5AA0"
                                                 ItemsSource="{Binding FileNames}"
                                                 ItemContainerStyle="{StaticResource FileListItemStyle}"
                                                 PreviewMouseMove="FileList_PreviewMouseMove"/>
                                    </Grid>
                                </Border>
                    
                                <!-- Splitter 2 -->
                                <GridSplitter Grid.Column="3" 
                                              Width="5" 
                                              HorizontalAlignment="Center" 
                                              VerticalAlignment="Stretch"
                                              Background="#4169E1"
                                              ShowsPreview="False"/>
                    
                                <!-- Panel 3 (Right) - removed per request -->
                                <Border Grid.Column="4" Margin="0" Padding="0" CornerRadius="6" Background="#8BB9F5"/>
                            </Grid>
                            <!-- End of Layer 3 Grid -->
                        </Border>
                        <!-- End of Border with horizontal padding -->
                        
                    </Grid>
                    <!-- End of Layer 2 Grid -->
                    
                </Grid>
                <!-- End of Grid container for golden lines -->
                
            </Border>
            <!-- End of Border with vertical padding -->
        
        </Grid>
        <!-- End of Layer 1 Grid -->
        
    </Border>
    <!-- End of Gold Border -->
    
</controls:MetroWindow>
